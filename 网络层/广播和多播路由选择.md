# 4.7 广播和多播路由选择

广播路由选择：网络层提供了从一种源结点到网络中的所有其他的结点交付分组的服务。

多播路由选择：从一个源结点能够向其他网络节点的一个子集发送分组的副本。

## 4.7.1 广播路由选择算法

实现广播的最直接方式：使用N次单播实现广播。

N次单播的缺点：

1. 效率低。
2. 广播的接收方及其地址需要被发送方所知。因此需要有另外的协议机制来实现，也增加了复杂性。
3. 在使用广播来生成和更新单播路由的情况下，基于单播路由选择来实现广播将是不明智的。

### 1. 无控制洪泛

实现广播的技术：洪泛。

思路：

    洪泛要求源结点向它的所有邻居发送分组的副本。当某节点接收了一个广播分组时，它复制该分组并向它的所有邻居转发之。

洪泛的致命缺点：

1. 如果该图有圈，则每个广播的一个或多个分组副本将无休无止地循环。
2. 当一个结点与两个以上其他结点连接时，它将产生并转发广播分组的多个副本，这些副本中的每个又产生多个它们自身的副本。

### 2. 受控洪泛

第一种实现方法是序号控制洪泛，如下：

1. 源结点将其自己的地址和广播序号放入广播分组，再向它的所有邻居发送该分组。
2. 每个结点维护它已经收到的源地址和每个广播分组序号的列表。
3. 当一个结点收到广播分组时，判断该分组是否在列表中，如果在，丢弃该分组；如果不在，复制该分组并向该节点的所有邻居转发。

第二种实现方法是反向路径转发，思路如下：

    当一台路由器接收到具有给定源地址的广播分组时。如果该分组到达的链路位于该结点返回其源的最短单播路径上，它才向其所有出链路传输报文，否则直接丢弃该分组。
    
    课本第270页有相应的例子。

### 3. 生成树广播

实现方法：
1. 首先对网络结点构造出一棵生成树。
2. 源结点发送一个广播分组时，它向生成树中的邻居转发该分组。
3. 接收广播分组的结点向在生成树中的邻居(向它发送该报文的邻居除外)转发该分组。

生成树的生成算法：基于中心的方法

1. 首先定义一个中心结点
2. 结点向中心结点单播“加入树”报文，该报文遇到生成树的结点时停止转发
3. 此时“加入树”报文经过的路径定义了一个新的生成树分支

    课本第272页举了基于中心生成树的构造过程。

## 4.7.2 多播

怎样表示多播分组的接收方？

    用一个标识来表示一组接收方

怎样为发送到这些接收方的分组编址？

    使用间接地址来编址，一组接收方的单一标识就是一个D类多播地址。

### 1. 因特网组管理协议

IGMP协议为一台主机提供了手段，让它通知与其相连的路由器：在本主机上运行的一个应用程序想加入一个特定的多播组。

IGMP有三种报文类型：

1. membership_query报文，用于确定该接口上主机已加入的所有多播组结合。
2. membership_report报文，用于响应membership_query报文。
3. leave_group报文，该报文可选。

如果使用了membership_query报文，当无主机响应一个具有给定组地址的membership_query报文时，该路由器就推断出已没有主机在这个多播组了。

    软状态协议：协议中的状态如果未能显式地更新，则通过超时事件被删除。

### 2. 多播路由选择算法

确定多播路由选择树的方法：

1. 使用一棵组共享树的多播路由选择。
2. 使用一棵基于源的树的多播路由选择。

### 3. 在因特网中的多播路由选择

两种算法：

1. 距离向量多播路由选择协议。
2. 协议无关的多播路由选择协议。